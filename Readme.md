This is webpack loader for [livescript](https://github.com/gkz/LiveScript) language that can extend its functionality by plugins which operate on AST generated by livescript.

# Plugins
For now there is very limited set of plugins:

- [implicit async functions](https://www.npmjs.com/package/livescript-transform-implicit-async)
- macros - for now build into loader itself (beware WIP) info on [github ](https://github.com/gkz/LiveScript/issues/982)
- [Object.create as an implementation of clone operator **^^**](https://www.npmjs.com/package/livescript-transform-object-create)
- [top level await](https://www.npmjs.com/package/livescript-transform-top-level-await)

# Installation

Install loader with 

    npm install --save-dev livescript-plugin-loader


# Configuration

Add loader rule to your webpack.config.ls

```livescript
module.exports =
    module:
        rules:
          * test: /\.ls$/
            exclude: /(node_modules|bower_components)/
            use: [
              * loader: \livescript-plugin-loader
            ]
          ...  
```


## Plugins

First install plugins that you want to use
    
    npm install --save-dev livescript-transform-top-level-await


Next add them to property `options.plugins` in loader configuration section in webpack.config.ls

```livescript
* loader: \livescript-plugin-loader
  options:
      plugins: <[
          livescript-transform-implicit-async
          livescript-transform-object-create
      ]>
```

If you want to pass some options to plugin use object instead of array
(right now it is meaningless because none of plugins use options)
```livescript
* loader: \livescript-plugin-loader
  options:
      plugins:
          \livescript-transform-implicit-async : {dummy: true}
```
Or use objects instead of strings
```livescript
* loader: \livescript-plugin-loader
  options:
      plugins:
        * name: \livescript-transform-object-create
          options: {dummy: true}
        ...
```

## Macros
This is just proof of concept implementation, totally experimental and disabled by default. To enable it set `macros` option to true.
```livescript
* loader: \livescript-plugin-loader
  options:
      macros: true
```

### Examples of macros
Right now you can use them to do simple thing like those:

generating debug information
```livescript
debug! = (...vars) -> 
    str = vars.map -> "\\#it #it"
    "[ #str ]"

foo = \FOO
bar = \BAR

console.log ...debug! foo, bar
# prints 'foo,FOO,bar,BAR'
```

in-place swapping
```livescript
swap! = (a,b) ->
    tmp = "tmp$#{Date.now!}"
    """
      #tmp = #a
      #a = #b
      #b = #a
    """
    
foo = \Bar
bar = \Foo
swap! foo,bar

assert foo == \Foo
asert bar == \Bar
```

iterating
```livescript
iterate! = (iterable, fn) ->
    iterator = "iterator$#{Date.now!}"
    itr = "itr$#{Date.now!}"
    """
        #iterator = #iterable[Symbol.iterator]!
        until (#itr = #iterator.next!).done
            #fn #itr.value
    """
      
simple-set = new Set [1,2,3]
log = -> console.log it
iterate! simple-set, log
```

importing from es6 modules
```livescript
import-all! = (_module) ->
    module-url = if _module.0 == "'"
        then _module
        else "\"#_module\""
    "``import * from #module-url``"
    
import-all! react
import-all! \semantic-ui-react
```

exporting es6 modules
```livescript
esm-export! = (a,b) ->
    if b?
      if a != "'default'"
          throw Error "Cannot rename export #b to #a. Renaming exports is not supported yet"
      "``export default #b``"
    else
        "export #a"
        
class Foo
class Bar
  
esm-export! \default, Foo
esm-export! Bar
```

### Warning
Macros aren't production-ready use them at your own risk. I've added them to show what livescript would be able to achieve with a just a little bit of love.

I've successfully compiled all my personal projects(there are no macros in them) with macros turn on so they shouldn't eat your hamster.

### Todo
- [ ] scope aware macros - right now they live in global scope
- [ ] exporting and importing macros - right now they are per file

# License
[BSD-3-Clause](License.md)
